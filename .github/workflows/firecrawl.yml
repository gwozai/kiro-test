name: Firecrawl ç½‘é¡µæŠ“å–

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'è¦æŠ“å–çš„ç½‘é¡µ URL'
        required: true
        default: 'https://github.com/gwozai'

jobs:
  crawl:
    runs-on: ubuntu-latest
    steps:
      - name: å®‰è£… Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: å¯åŠ¨ Firecrawl å¹¶æŠ“å–
        run: |
          # å®‰è£… firecrawl
          npm install @mendable/firecrawl-js
          
          # ç”±äº Firecrawl éœ€è¦ API keyï¼Œæˆ‘ä»¬ç”¨ç®€å•çš„æ–¹å¼æŠ“å–
          # ä½¿ç”¨ curl + html2text ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆ
          sudo apt-get update && sudo apt-get install -y html2text
          
          echo "ğŸ”¥ å¼€å§‹æŠ“å–: ${{ github.event.inputs.url }}"
          echo "================================"
          
          # æŠ“å–ç½‘é¡µå¹¶è½¬æ¢ä¸ºæ–‡æœ¬
          curl -s "${{ github.event.inputs.url }}" | html2text | head -200
          
          echo "================================"
          echo "âœ… æŠ“å–å®Œæˆ!"

      - name: ä½¿ç”¨ Playwright æŠ“å– (å¤‡é€‰æ–¹æ¡ˆ)
        run: |
          npm install playwright
          npx playwright install chromium --with-deps
          
          cat > crawl.js << 'EOF'
          const { chromium } = require('playwright');
          
          (async () => {
            const browser = await chromium.launch();
            const page = await browser.newPage();
            const url = process.argv[2] || 'https://github.com';
            
            console.log(`\nğŸŒ ä½¿ç”¨ Playwright æŠ“å–: ${url}\n`);
            
            await page.goto(url, { waitUntil: 'networkidle' });
            
            const title = await page.title();
            console.log(`ğŸ“„ æ ‡é¢˜: ${title}\n`);
            
            const text = await page.evaluate(() => {
              return document.body.innerText.substring(0, 3000);
            });
            
            console.log('ğŸ“ é¡µé¢å†…å®¹ (å‰3000å­—ç¬¦):');
            console.log('â”€'.repeat(50));
            console.log(text);
            console.log('â”€'.repeat(50));
            
            await browser.close();
          })();
          EOF
          
          node crawl.js "${{ github.event.inputs.url }}"
